{% extends 'app/layouts/main.html' %}
{% load static %} 
{% block title %}
QUOTATION
{% endblock title %}
{% block content %}
<style>
    #box0{
        height: 100%;
        width: 100%;
        border: 2px solid black;
        background-color:lightgray;
        
    }

    label {
    display: inline-block;
    width: 130px;
    margin-top: 10px;
    text-align:  right;
    margin-left: 1px;
    
    
}
select {
    margin-top: 10px;
    box-sizing: border-box;
    width: 10%;
    height: 30px;
    margin-left: 10px;
}

input{
    margin-left: 1px;
    width: 10%;
}
#customer_address{
    height: 50px;
    width: 400px;
    margin-left: 30px;
    margin-top: 10px;
}

table {
    border-collapse: collapse;
    width: 100%;
    background-color: rgb(199, 199, 241);
    
}

th, td {
    border: 1px solid black;
    padding: 8px;
    text-align: center;
}
th{
    background-color: orange;
}
#add_new_btn{
    margin-left: 40%;
}
.container_box{
    height: 100%;
    width: 100%;
    border: 2px solid black;
    background-color:lightgray;
}
#control_btn_div{
    margin-left: 20%;
    margin-top: 10px;
}
#cancel-btn{
    height: 40px;
    width: 130px;
    background-color:yellow;
    color: black;
    text-align: center;
    font-weight: bold;
}

#submit-btn{
    height: 40px;
    width: 130px;
    background-color:green;
    margin-left: 50px;
    color: white;
    text-align: center;
    font-weight: bold;
}
#delete-btn{
    height: 40px;
    width: 130px;
    background-color:red;
    margin-left: 50px;
    color: white;
    text-align: center;
    font-weight: bold;  
}
#create_btn{
    background-color:blue;
    color: white;
    font-weight: bold;
    width: 150px;
    height: 30px;
    margin-left: 15%;
}
#print_preview{
    background-color:blue;
    color: white;
    font-weight: bold;
    font-size: small;
    width: 150px;
    height: 30px;
    margin-left: 1%;
}
#refresh-btn1,#refresh-btn2 i {
    font-size: 20px;  /* Adjust size of the icon */
    color: #007bff;   /* Adjust color if needed */
}

#refresh-btn1,#refresh-btn2:hover i {
    color: #0056b3;   /* Hover effect for the icon */
}

#notification {
    display: none;
    position: fixed;    
    top: 40%;
    left: 40%;
    height: 120px;
    width: 350px;
    transform: translate(-50%, -50%);
    padding: 10px;
    border-radius: 5px;
    font-weight: bold;
    color: black;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); 
    z-index: 1000; 
    border: 2px solid black;
}
.selected-row {
    background-color: green;
}

.edit-cell {
    width: 100%;
    border: 1px solid #ddd;
    margin-left: 0px;
}
.custom-checkbox {
            width: 15px;
            height: 15px;
            accent-color: red;
        }
/* Ensure the checkbox is visually enabled but not interactable */
.readonly-checkbox {
    pointer-events: none; /* Disable pointer interaction */
    opacity: 1; /* Ensure itâ€™s fully visible */
}

/* Make inputs and selects fill the whole table cell area */
#tableBody-1 input,
#tableBody-1 select {
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    border: none;
    outline: none;
    padding: 0;
    margin: 0;
    background-color: white;
    font-size: 14px;
    display: block; /* Ensures full area coverage */
}

/* Remove space inside table cells */
#tableBody-1 td {
    padding: 0;
    margin: 0;
    height: 32px; /* optional: you can adjust the cell height */
    line-height: 1; /* keeps vertical alignment tight */
}

/* Optional: make the table layout consistent */
#tableBody-1 {
    border-collapse: collapse;
}


/* Hover and select on <td> so it appears behind inputs */
#tableBody-1 tr:hover td {
    background-color: #e6f2ff !important; /* Light blue hover */
}

#tableBody-1 tr.selected-row td {
    border: 2px solid red !important; /* Red border */
    box-shadow: 0 0 5px 2px rgba(255, 0, 0, 0.7); /* Red glow around cells */
    
    transition: all 0.2s ease-in-out;
}



</style>

<div id="notification"></div>

<div class="box0" id="box0">
    <div class="heading" style="display: flex;">
        <h3 style="margin-left: 45%;"><b>QUOTATION</b></h3>
        <button type="submit" id="create_btn"> CREATE NEW</button>
         <button type="submit" id="print_preview"  onclick="redirectToInvoice()"> PROFORMA INVOICE</button>
    </div>

    <div class="1st_container" style="display: flex;">
        <label for="search" style="width: 100px;margin-top: 10px;margin-left: 0px;">CUSTOMER:</label>
                <input list="customers" id="search-input" style="width: 400px;" onkeyup="fetchWorkOrders()">
                    <datalist id="customers">
                        {% for customer in customer_value %}
                        <option value="{{ customer.customer_name }}" 
                        data-address="{{ customer.address }}" 
                        data-primary-email="GST:{{ customer.gst_no }}">
                    </option>
                        {% endfor %}
                    </datalist>
        <button type="button" id="refresh-btn1" style="border: none; background: none; cursor: pointer;">
            <i class="fa fa-refresh"></i>
        </button>

        <label for="order_type" style="margin-left: 1px;">ORDER TYPE :</label>
        <select  id="order_type" >
            <option>SALES</option>
            <option>SERVICE</option>
            <option>CALIBRATIONS</option>
        </select>

        <label for="quote_no" style="margin-left: -10px;">QUOT NO :</label>
        <input list="quote_no_datalist" id="quote_no" name="quote_no">
        <datalist id="quote_no_datalist"></datalist>
        <button type="button" id="refresh-btn2" style="border: none; background: none; cursor: pointer;">
            <i class="fa fa-refresh"></i>
        </button>
        <label for="quote_date"  style="margin-left: -10px;" >QUOT DATE :</label>
        <input type="date" id="quote_date">
    </div>


    <div class="2nd_container" style="display: flex;">
        <textarea id="customer_address"></textarea>
        <label for="enquiry_type" style="margin-left: 20px;width: 160px;">ENQUIRY TYPE :</label>
        <select  id="enquiry_type" >
            <option>EMAIL</option>
            <option>DIRECT</option>
            <option>REF</option>
        </select>
    
        
        <label for="enquiry_date" style="width: 150px;margin-left: 10px;height: 50px;">ENQUIRY DATE :</label>
        <input type="date" id="enquiry_date" >

        
       

    </div>
    
    
                    
               
    
    
    
    
    

    
    
    
    

    <div class="container_box" style="overflow-y: auto;">
    <div id="quotation_table">
        <table border="1">
            <thead>
                <tr>
                    <th >Sr.No</th>
                    <th style="width: 10%;">ITEM</th>
                    <th style="width: 15%;">ITEM TYPE</th>
                    <th>MODEL NO</th>
                    <th>NO.OF.JET</th>
                    <th >NO.OF.LEVEL</th>
                    <th>TYPE</th>
                    <th>MAKE</th>
                    <th >UNIT</th>
                    <th>PRICE</th>
                    <th>DISC % </th>
                    <th>DISC RS </th>
                    <th> AMOUNT</th>
                   
                </tr>
            </thead>
            <tbody id="tableBody-1">
                
            </tbody>
            
        </table>
        <br>
        <button  id="add_new_btn" onclick="addRow('quotation_table', 13)">Add New</button>
        <div id="control_btn_div"> 
            <a href="/index/">
                <button type="button" id="cancel-btn">BACK</button>
            </a>
            <button id="delete-btn">DELETE</button>
            <button id="submit-btn">SAVE</button>

           
        </div>
        <div>
        </div>
</div>
<script>


function redirectToInvoice() {
    const workOrderInput = document.getElementById('work_order_no');
    const selectedValue = workOrderInput.value;

    console.log("Selected Value:", selectedValue);
    if (selectedValue) {
        // Redirect to the "invoice/" page with the selected value as a query parameter
        window.location.href = `/invoice/?work_order_no=${encodeURIComponent(selectedValue)}`;
    } else {
        alert('Please select or enter a WORK ORDER NO before proceeding.');
    }
}

//////////////////////////////////////////////////////////////////////////////////////////
document.getElementById('refresh-btn1').addEventListener('click', function() {
    document.getElementById('search-input').value = '';  // Clears the date input field
});
document.getElementById('refresh-btn2').addEventListener('click', function() {
    document.getElementById('work_order_no').value = '';  // Clears the date input field

     // Clear the other input fields
     document.getElementById('wo_date').value = ''; 
    document.getElementById('customer_po_no').value = ''; 
    document.getElementById('customer_ref_date').value = ''; 
    // Reset the ORDER TYPE select field to its default (first) option
    document.getElementById('next_calibration').selectedIndex = 0; 

    // Clear the table contents by removing all rows in the table body
    document.getElementById('tableBody-1').innerHTML = ''; 
});









///////////////////////////////////////////////////////////////////////////

var rowData = {};

function addRow(tableId, numColumns) {
    var tableBody = document.querySelector('#' + tableId + ' tbody');
    var newRow = tableBody.insertRow(tableBody.rows.length);

    // Mark the row as new
    newRow.setAttribute('data-new', 'true');

    // Get the work_order_no input value
    var workOrderNo = document.getElementById('work_order_no') ? document.getElementById('work_order_no').value : "WO";

    // Calculate the new Sr.No based on the work_order_no
    var serialSuffix = String(tableBody.rows.length).padStart(2, '0');  
    var serialNumber = workOrderNo + '/' + serialSuffix;

    // Add click event to highlight the row on click
    newRow.addEventListener('click', function(event) {
        var rows = tableBody.querySelectorAll('tr');
        rows.forEach(function(row) {
            row.style.backgroundColor = '';
        });
        event.currentTarget.style.backgroundColor = 'red';
    });

    for (var i = 0; i < numColumns; i++) {
        var cell = newRow.insertCell(i);

        // Sr.No column
        if (i === 0) {
            cell.textContent = serialNumber;
        }
        // ITEM
        else if (i === 1) {
            var selectItem = document.createElement('select');
            selectItem.style.width = '100%';
            selectItem.innerHTML = `
                <option value="">Select Item</option>
                <option value="Measurement">Measurement</option>
                <option value="Gauges">Gauges</option>
            `;
            cell.appendChild(selectItem);
        }
        // ITEM TYPE
        else if (i === 2) {
            var selectType = document.createElement('select');
            selectType.style.width = '100%';
            selectType.innerHTML = `
                <option value="">Select Type</option>
                <option value="APG">APG</option>
                <option value="ARG">ARG</option>
                <option value="ASP">ASP</option>
            `;
            cell.appendChild(selectType);
        }
        // MODEL NO
        else if (i === 3) {
            var input = document.createElement('input');
            input.type = 'text';
            input.style.width = '100%';
            cell.appendChild(input);
        }
        // NO.OF.LEVEL
        else if (i === 4) {
            var selectLevel = document.createElement('select');
            selectLevel.style.width = '100%';
            selectLevel.innerHTML = `
                <option value="">Select Level</option>
                <option value="2 Level">2 Level</option>
                <option value="3 Level">3 Level</option>
                <option value="4 Level">4 Level</option>
            `;
            cell.appendChild(selectLevel);
        }
        // NO.OF.JET
        else if (i === 5) {
            var selectJet = document.createElement('select');
            selectJet.style.width = '100%';
            selectJet.innerHTML = `
                <option value="">Select Jet</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            `;
            cell.appendChild(selectJet);
        }
        // TYPE
        else if (i === 6) {
            var selectMount = document.createElement('select');
            selectMount.style.width = '100%';
            selectMount.innerHTML = `
                <option value="">Select Mount Type</option>
                <option value="Hand Mounted">Hand Mounted</option>
                <option value="Bench Mounted">Bench Mounted</option>
            `;
            cell.appendChild(selectMount);
        }
        // Remaining columns (MAKE, UNIT, PRICE, DISC %, DISC RS, AMOUNT)
        else {
            var input = document.createElement('input');
            input.type = 'text';
            input.style.width = '100%';
            input.style.border = 'none';
            input.style.outline = 'none';
            cell.appendChild(input);
        }
    }

    // Save row data
    if (!rowData[tableId]) {
        rowData[tableId] = [];
    }
    rowData[tableId].push({
        rowIndex: newRow.rowIndex,
        values: Array.from(newRow.cells).map(cell => {
            var inputElement = cell.querySelector('input, select');
            return inputElement ? inputElement.value : '';
        })
    });

    // Attach calculation events for this new row
    attachRowEvents(newRow);
}

/////////////////////////////////////////////////////////////////////////
// Customer search code (unchanged)
document.getElementById('search-input').addEventListener('input', function() {
    const inputValue = this.value;
    const options = document.getElementById('customers').options;
    
    for (let i = 0; i < options.length; i++) {
        if (options[i].value === inputValue) {
            const customerName = options[i].value;
            const address = options[i].getAttribute('data-address') || '';
            const primaryEmail = options[i].getAttribute('data-primary-email') || '';
            document.getElementById('customer_address').value = 
                ` ${customerName}\n ${address}\n ${primaryEmail}`;
            break;
        }
    }
});
/////////////////////////////////////////////////////////////////////////

// =================== LIVE CALCULATION FUNCTIONS ===================

// Update AMOUNT
function updateAmount(row) {
    const price = parseFloat(row.querySelector('td:nth-child(10) input').value) || 0;
    const discRS = parseFloat(row.querySelector('td:nth-child(12) input').value) || 0;
    row.querySelector('td:nth-child(13) input').value = (price - discRS).toFixed(2);
}

// Update DISC RS based on %
function updateDiscountRS(row) {
    const price = parseFloat(row.querySelector('td:nth-child(10) input').value) || 0;
    const discPercent = parseFloat(row.querySelector('td:nth-child(11) input').value) || 0;
    row.querySelector('td:nth-child(12) input').value = ((price * discPercent) / 100).toFixed(2);
    updateAmount(row);
}

// Function to update DISC % based on RS
function updateDiscountPercent(row) {
    const price = parseFloat(row.querySelector('td:nth-child(10) input').value) || 0;
    const discRS = parseFloat(row.querySelector('td:nth-child(12) input').value) || 0;
    const discPercentInput = row.querySelector('td:nth-child(11) input');

    let percentValue = price ? ((discRS / price) * 100).toFixed(2) : 0;
    
    // Display with % symbol as suffix
    discPercentInput.value = percentValue + '%';

    // Update Amount just in case
    updateAmount(row);
}

// Remove % symbol while editing
$(document).on('focus', 'td:nth-child(11) input', function() {
    this.value = this.value.replace('%', '');
});

// Re-add % symbol on blur
$(document).on('blur', 'td:nth-child(11) input', function() {
    if (this.value !== '') {
        this.value = parseFloat(this.value).toFixed(2) + '%';
        // Update DISC RS based on new %
        const row = $(this).closest('tr')[0];
        const price = parseFloat(row.querySelector('td:nth-child(10) input').value) || 0;
        const percent = parseFloat(this.value) || 0;
        row.querySelector('td:nth-child(12) input').value = ((price * percent) / 100).toFixed(2);
        updateAmount(row);
    }
});


// Attach events to a row
function attachRowEvents(row) {
    const priceInput = row.querySelector('td:nth-child(10) input');
    const discPercentInput = row.querySelector('td:nth-child(11) input');
    const discRSInput = row.querySelector('td:nth-child(12) input');

    priceInput.addEventListener('input', function() {
        updateAmount(row);
        updateDiscountRS(row);
    });

    discPercentInput.addEventListener('input', function() {
        updateDiscountRS(row);
    });

    discRSInput.addEventListener('input', function() {
        updateDiscountPercent(row);
    });
}

/////////////////////////////////////////////////////////////////////////
// Row click highlight & inline editing (unchanged)
let selectedRowId = null;
$(document).on('click', '#tableBody-1 tr', function() {
    $('#tableBody-1 tr').removeClass('selected-row');
    $(this).addClass('selected-row');
    selectedRowId = $(this).data('row-id');

    $(this).find('td').each(function(index) {
        if (!$(this).hasClass('editing')) {
            const value = $(this).text().trim();
            if(index === 1 || index === 2 || index === 4 || index === 5 || index === 6) {
                // Already handled as selects in addRow()
            } else if(index >= 3 && index <= 13){
                $(this).html(`<input type="text" value="${value}" class="edit-cell">`);
            }
            $(this).addClass('editing');
        }
    });

    attachRowEvents(this); // ensure events attach when row clicked
});

/////////////////////////////////////////////////////////////////////////
// Function to collect all table data
function collectData() {
    let tableRows = [];
    $('#tableBody-1 tr').each(function() {
        const row = $(this);
        const rowData = {
            sr_no: row.find('td:nth-child(1)').text().trim(),
            item: row.find('td:nth-child(2) select').length ? row.find('td:nth-child(2) select').val() : row.find('td:nth-child(2) input').val(),
            item_type: row.find('td:nth-child(3) select').length ? row.find('td:nth-child(3) select').val() : row.find('td:nth-child(3) input').val(),
            model_no: row.find('td:nth-child(4) input').val(),
            no_of_level: row.find('td:nth-child(5) select').length ? row.find('td:nth-child(5) select').val() : row.find('td:nth-child(5) input').val(),
            no_of_jet: row.find('td:nth-child(6) select').length ? row.find('td:nth-child(6) select').val() : row.find('td:nth-child(6) input').val(),
            type: row.find('td:nth-child(7) select').length ? row.find('td:nth-child(7) select').val() : row.find('td:nth-child(7) input').val(),
            make: row.find('td:nth-child(8) input').val(),
            unit: row.find('td:nth-child(9) input').val(),
            price: row.find('td:nth-child(10) input').val(),
            discount_percent: row.find('td:nth-child(11) input').val(),
            discount_rs: row.find('td:nth-child(12) input').val(),
            amount: row.find('td:nth-child(13) input').val()
        };

        if (rowData.item || rowData.model_no) {
            tableRows.push(rowData);
        }
    });

    console.log("Collected Data:", tableRows);
    return tableRows;
}









/////////////////////////////////////////////////////////////////////////

$(document).ready(function() {
    $('#submit-btn').click(function() {
    // Collect input values
    var customerName = $('#search-input').val();
    var woDate = $('#wo_date').val();
    var workOrderNo = $('#work_order_no').val();
    var customerPoNo = $('#customer_po_no').val();
    var customerRefDate = $('#customer_ref_date').val();
    var orderType = $('#next_calibration').val();
    var customerAddress = $('#customer_address').val();

   
    // Use the collectData function to get table row data
    const tableRows = collectData(); // Call the collectData function
    
    // Bundle all data into one JSON object
    var formData = {
        customerName: customerName,
        woDate: woDate,
        workOrderNo: workOrderNo,
        customerPoNo: customerPoNo,
        customerRefDate: customerRefDate,
        orderType: orderType,
        customerAddress: customerAddress,
        items: tableRows
    };

    console.log("The data being sent to the backend (views.py):", formData);

    // CSRF token
    const csrftoken = getCookie('csrftoken');

    // Send data using Fetch API
    fetch('/inward/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log('Success:', data);
        showNotification('Data saved successfully', true);

        // Adjust this part to check for duplicates based on specific fields
        if (data.skipped_items && data.skipped_items.length > 0) {
            let skippedItems = data.skipped_items.map(item => item.srNo).join(', ');
            alert('The following items with the same Serial No., ID No., and HSN code were not saved again: ' + skippedItems);

            // Remove the rows with skipped items from the table based on these fields
            data.skipped_items.forEach(function(skippedItem) {
                $('#tableBody-1 tr').each(function() {
                    var row = $(this);
                    var srNo = row.find('td:nth-child(4) input').val();
                    var idNo = row.find('td:nth-child(5) input').val();

                    if (srNo === skippedItem.srNo && idNo === skippedItem.idNo ) {
                        row.remove();
                    }
                });
            });
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('Error saving data: ' + error.message, false);
    });
});

});



// Function to get the CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

///////////////////////////////////////////////////////////////////
function fetchWorkOrders() {
    const customerInput = $('#search-input'); // Get the input field as a jQuery object
    const workOrderDatalist = $('#work_order_datalist'); // Reference to the work order datalist
    const workOrderInput = $('#work_order_no'); // Reference to the work order input field

    // Clear the work order input field and datalist
    // workOrderInput.val(''); // Clear the work order input field
    // workOrderDatalist.empty(); // Clear previous work order options

    // Get the selected customer name
    const inputValue = customerInput.val(); 

    // Clear the work order datalist and input field if customer input is empty
    if (!inputValue) {
        workOrderDatalist.empty(); // Clear work order datalist if customer input is empty
        return; // Exit the function early
    }

    // Clear the previous options in the work order datalist
    workOrderDatalist.empty(); 

    // AJAX POST request to fetch work orders for the selected customer
    $.ajax({
        type: 'POST',
        url: '/inward/', // Your AJAX endpoint
        data: {
            'customer_name': inputValue,
            'csrfmiddlewaretoken': '{{ csrf_token }}' // Include CSRF token for Django
        },
        success: function(data) {
            // Check if any work orders were returned
            if (data.length > 0) {
                // Populate the datalist with the received work orders
                $.each(data, function(index, workOrder) {
                    const option = $('<option>').val(workOrder.work_order_no);
                    workOrderDatalist.append(option);
                });
            } else {
                // Optionally, you can add a message for no work orders found
                const option = $('<option>').val('No work orders found');
                workOrderDatalist.append(option);
            }
        },
        error: function(xhr, status, error) {
            console.error('Error fetching work orders:', error);
        }
    });
}

///////////////////////////////////////////////////////////////////////////////////////////////

$(document).ready(function() {
    // Triggered when a work order is selected from the datalist
    $('#work_order_no').on('change', function() {
        const workOrderNo = $(this).val(); // Get the selected work order number

        if (workOrderNo) {
            // Make an AJAX call to fetch the data for the selected work order
            $.ajax({
                type: 'GET',
                url: '/inward/', // Replace with your actual endpoint
                data: {
                    'work_order_no': workOrderNo
                },
                success: function(response) {
                    if (response.success) {
                        // Populate the respective fields with the data received
                        $('#wo_date').val(response.wo_date);
                        $('#customer_po_no').val(response.customer_po_no);
                        $('#customer_ref_date').val(response.customer_ref_date);
                        $('#next_calibration').val(response.order_type);
                        $('#customer_address').val(response.customer_address);
                        
                        // If you have a table to populate:
                        const tableBody = $('#tableBody-1');
                        tableBody.empty(); // Clear previous rows
                        
                         // Populate table with items if any exist
                         if (response.items) {
                            response.items.forEach((item, index) => {
                                const checkboxChecked = item.is_in_main_calibration ? 'checked' : ''; // Conditionally add "checked"
                                const row = `<tr data-row-id="${item.inward_no}">
                                    <td>${item.inward_no}</td>
                                    <td>${item.item}</td>
                                    <td>${item.hsn}</td>
                                    <td>${item.sr_no}</td>
                                    <td>${item.id_no}</td>
                                    <td>${item.range}</td>
                                    <td>${item.make}</td>
                                    <td>${item.channels}</td>
                                    <td><input type="checkbox" class="custom-checkbox readonly-checkbox" ${checkboxChecked}></td>
                                </tr>`;
                                tableBody.append(row);
                            });
                        }
                    } else {
                        console.error('Error fetching work order data:', response.error);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching work order data:', error);
                }
            });
        }
    });
});

///////////////////////////////////////////////////////////////////////

$(document).ready(function() {
    $('#create_btn').on('click', function() {
         // Clear all form input values
         $('#search-input').val('');
        $('#work_order_no').val('');
        $('#wo_date').val('');
        $('#customer_po_no').val('');
        $('#customer_ref_date').val('');
        $('#customer_address').val('');
        $('#next_calibration').prop('selectedIndex', 0); // Reset the select to the first option
        $('#tableBody-1').empty(); // Clear all table rows

        $.ajax({
            url: '{% url "inward" %}?generate_inward_no=true',  // Pass generate_inward_no in the URL
            method: 'GET',
            success: function(response) {
                if (response.new_inward_no) {
                    $('#work_order_no').val(response.new_inward_no);  // Set the new inward_no
                } else {
                    alert('Could not generate new inward number.');
                }
            },
            error: function() {
                alert('Error occurred while generating inward number.');
            }
        });
    });
});


////////////////////////////////////////////////////////////////////////



$('#delete-btn').on('click', function() {
    if (selectedRowId) {
        console.log("Attempting to delete work order ID:", selectedRowId); // Log for debugging

        // Send the delete request to the backend using Ajax
        $.ajax({
            url: '/inward/',  // Ensure this URL matches your Django URL configuration
            type: 'DELETE',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')  // CSRF protection
            },
            data: JSON.stringify({ work_order_id: selectedRowId }),
            contentType: 'application/json',
            success: function(response) {
                if (response.success) {
                    // Remove the row from the DOM
                    $('tr[data-row-id="' + selectedRowId + '"]').remove();
                    selectedRowId = null;  // Reset the selected row ID
                    showNotification('Row deleted successfully!', true);
                } else {
                    showNotification('Failed to delete row: ' + response.error, false);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error deleting row:', xhr.responseText); // Log the error for debugging
                showNotification('Error deleting row: ' + error, false);
            }
        });
    } else {
        alert('Please select a row to delete.');
    }
});























 // Function to show a notification with an OK button
 function showNotification(message, isSuccess) {
    var notificationElement = document.getElementById('notification');
    notificationElement.textContent = message;

    if (isSuccess) {
        notificationElement.style.backgroundColor = 'lightgreen';
    } else {
        notificationElement.style.backgroundColor = 'coral';
    }

    // Center the notification vertically and horizontally
    notificationElement.style.display = 'flex';
    notificationElement.style.flexDirection = 'column';
    notificationElement.style.alignItems = 'center';
    notificationElement.style.textAlign = 'center';
    notificationElement.style.justifyContent = 'center';
    notificationElement.style.top = '50%';
    notificationElement.style.left = '50%';
    notificationElement.style.transform = 'translate(-50%, -50%)';
    notificationElement.style.zIndex = '1000';

    // Display the notification
    notificationElement.style.display = 'block';

    // Hide the notification after 2 seconds
    setTimeout(function() {
        notificationElement.style.display = 'none';
    }, 2000);
}


window.addEventListener('DOMContentLoaded', (event) => {
            var inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.setAttribute('autocomplete', 'off');
            });
        });


</script>
{% endblock content %}